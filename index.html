<html>
  <head>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  </head>
  <style>
    textarea {
      min-height: 200px;
      width: 100%;
    }
  </style>
  <script>
    function findAll(regexPattern, sourceString) {
          let output = []
          let match
          // make sure the pattern has the global flag
          let regexPatternWithGlobal = RegExp(regexPattern,"g")
          while (match = regexPatternWithGlobal.exec(sourceString)) {
              // get rid of the string copy
              delete match.input
              // store the match data
              output.push(match)
          }
          return output
      }
  </script>
  <body>
    <h1>
      E-Learning Cheater
    </h1>


    <hr />

    <h1>
      穴埋め
    </h1>

    <h2>
      入力
    </h2>
    <textarea id="hole_in"></textarea>
    <h2>
      答え
    </h2>
    <ol id="hole_out">
    </ol>

    <script>
      $("#hole_in").bind("input propertychange", function() {
          let re = /\[[a-zA-Z']+\]/;
          let out = "";
          let outs = findAll(re, this.value)
          let outi = $("#hole_out")
          outi.empty()
          var x;
          for(x in outs) {
              let y = String(outs[x]);
              y = y.substring(1, y.length-1);
              if(y == 'Cloze') continue;
              outi.append("<li>" + y + "</li>");
          };
      })
    </script>

    <hr />

    <h1>
      文中単語選択
    </h1>

    <textarea id="sencho_in"></textarea>

    <h2>
      答え
    </h2>
    <ul id="sencho_out">

    </ul>

    <script>
      $("#sencho_in").bind("input propertychange", function() {
          let re = /\[\*[a-zA-Z']+\*\]/;
          let out = "";
          let outs = findAll(re, this.value)
          let outi = $("#sencho_out")
          outi.empty()
          var x;
          for(x in outs) {
              let y = String(outs[x])
              outi.append("<li>" + y.substring(2, y.length-2) + "</li>");
          };
      });
      </script>

    <hr />

    <h1>
      Listening
    </h1>

    <h2>
      入力
    </h2>

    <textarea id="listening_in"></textarea>
    <h2>
      答え
    </h2>
    <ul id="listening_out">

    </ul>

    <script>

      $("#listening_in").bind("input propertychange", function() {
          xmlDoc = $.parseXML(this.value);
          let $xml = $(xmlDoc)

          let qs = $xml.find("question")
          let i = 0;
          for(i = 0; i < qs.length; i++) {

              let ans = $(qs[i]).find("answer")[0].innerHTML

              let choices = $(qs[i]).find("choice")
              let j = 0;
              for(j = 0; j < choices.length; j++) {
                  let v = choices[j].attributes["no"].value;
                  if(v == ans) $("#listening_out").append("<li>" + choices[j].innerHTML + "</li>")
              }


          }

      });

    </script>

  </body>
</html>
